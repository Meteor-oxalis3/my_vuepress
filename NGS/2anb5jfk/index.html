<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.18" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><meta property="og:url" content="https://meteor-oxalis3.com/NGS/2anb5jfk/"><meta property="og:site_name" content="Meteor03's Oxalis Garden"><meta property="og:title" content="Project 01"><meta property="og:description" content="2024 秋学期 高通量大作业 | 22230111 郎程闰 表观遗传组 基于 1. 前言 1.1 背景 慢性丙型肝炎病毒 ( HCV ) 感染是导致肝硬化和肝细胞癌 ( HCC ) 的主要致病因素。在全球范围内，约有 7100 万慢性 HCV 感染者，其中 10-20% 的患者在其一生中可能出现严重的肝脏并发症。表观遗传机制 ( 如 DNA 甲基化和..."><meta property="og:type" content="article"><meta property="og:image" content="https://meteor-oxalis3.com/home/saturn/10_Typora/NGS_Project01/ATAC_seq_Data.png"><meta property="og:locale" content="zh-CN"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Project 01","image":["https://meteor-oxalis3.com/home/saturn/10_Typora/NGS_Project01/ATAC_seq_Data.png"],"dateModified":null,"author":[]}</script><link rel="icon" href="/favicon.png"><script async defer data-website-id="6a50a10d-337b-441a-a771-e4e1364aa308" src="https://umami.dudleya.cc/script.js"></script><title>Project 01 | Meteor03's Oxalis Garden</title><meta name="description" content="2024 秋学期 高通量大作业 | 22230111 郎程闰 表观遗传组 基于 1. 前言 1.1 背景 慢性丙型肝炎病毒 ( HCV ) 感染是导致肝硬化和肝细胞癌 ( HCC ) 的主要致病因素。在全球范围内，约有 7100 万慢性 HCV 感染者，其中 10-20% 的患者在其一生中可能出现严重的肝脏并发症。表观遗传机制 ( 如 DNA 甲基化和..."><link rel="preload" href="/assets/style-n9qrfc56.css" as="style"><link rel="stylesheet" href="/assets/style-n9qrfc56.css"><link rel="modulepreload" href="/assets/app-BTx-WnE2.js"><link rel="modulepreload" href="/assets/index.html-BTg0Ch0S.js"><link rel="prefetch" href="/assets/index.html-mLaavfZK.js" as="script"><link rel="prefetch" href="/assets/index.html-KCZ2h2xa.js" as="script"><link rel="prefetch" href="/assets/index.html-C6zwRIHT.js" as="script"><link rel="prefetch" href="/assets/index.html-DiXAdbh6.js" as="script"><link rel="prefetch" href="/assets/index.html-BP8e1o8B.js" as="script"><link rel="prefetch" href="/assets/index.html-CVr_tdbQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DgsB9Mry.js" as="script"><link rel="prefetch" href="/assets/index.html-bUWwDPlv.js" as="script"><link rel="prefetch" href="/assets/index.html-CMTm5TMo.js" as="script"><link rel="prefetch" href="/assets/index.html-Co8bodfN.js" as="script"><link rel="prefetch" href="/assets/index.html-CkBzpGu2.js" as="script"><link rel="prefetch" href="/assets/index.html-CZS-zacO.js" as="script"><link rel="prefetch" href="/assets/index.html-Dzcow_tU.js" as="script"><link rel="prefetch" href="/assets/index.html-DnKZZmcZ.js" as="script"><link rel="prefetch" href="/assets/index.html-X-HeEhW7.js" as="script"><link rel="prefetch" href="/assets/index.html-BZkT39Pd.js" as="script"><link rel="prefetch" href="/assets/index.html-DyXjuuof.js" as="script"><link rel="prefetch" href="/assets/index.html-B8vJnd-r.js" as="script"><link rel="prefetch" href="/assets/index.html-D95uij3B.js" as="script"><link rel="prefetch" href="/assets/index.html-CHFuL6yN.js" as="script"><link rel="prefetch" href="/assets/index.html-CWH1Dc2g.js" as="script"><link rel="prefetch" href="/assets/index.html-Cq9sCu4E.js" as="script"><link rel="prefetch" href="/assets/404.html-BbPFN_2w.js" as="script"><link rel="prefetch" href="/assets/index.html-DE0DivKL.js" as="script"><link rel="prefetch" href="/assets/index.html-DXNrMsFQ.js" as="script"><link rel="prefetch" href="/assets/index.html-BrsWm1CM.js" as="script"><link rel="prefetch" href="/assets/index.html-BpQn_LB7.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/searchBox-default-C71cH4mV.js" as="script"><link rel="prefetch" href="/assets/SearchBox-DQya90k-.js" as="script"><link rel="prefetch" href="/assets/giscus-BZxmVUME.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-pokw6En4.js" as="script"></head><body><div id="app"><!--[--><div class="theme-plume vp-layout" vp-container data-v-0b7e05b4><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-d5a8d0bc></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-d5a8d0bc> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-0b7e05b4 data-v-d34f28d6><div class="vp-navbar" vp-navbar data-v-d34f28d6 data-v-70d97d16><div class="wrapper" data-v-70d97d16><div class="container" data-v-70d97d16><div class="title" data-v-70d97d16><div class="vp-navbar-title has-sidebar" data-v-70d97d16 data-v-2c8d4622><a class="vp-link no-icon link title" href="/" data-v-2c8d4622 data-v-442a52aa><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" src="/vuepress_logo.png" alt data-v-7fbfbc9b><!--]--><!--[--><img class="vp-image light logo" src="/vuepress_logo.png" alt data-v-7fbfbc9b><!--]--><!--]--><!--]--><span data-v-2c8d4622>Meteor03&#39;s Oxalis Garden</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-70d97d16><div class="content-body" data-v-70d97d16><!--[--><!--]--><div class="vp-navbar-search search" data-v-70d97d16><div class="search-wrapper" data-v-97535d1e><!----><div id="local-search" data-v-97535d1e><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-97535d1e><span class="mini-search-button-container"><svg class="mini-search-search-icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-70d97d16 data-v-d43c1732><span id="main-nav-aria-label" class="visually-hidden" data-v-d43c1732>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/NGS/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>NGS</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/R/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>R</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/about/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>关于</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="https://meteor-oxalis3.github.io" target="_blank" rel="noreferrer" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>朝花夕拾</span><!--]--><span class="vpi-external-link icon" data-v-442a52aa></span></a><!--]--><!--]--></nav><!----><div class="vp-navbar-appearance appearance" data-v-70d97d16 data-v-a295abf6><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-a295abf6 data-v-537740e0 data-v-d84fedac><span class="check" data-v-d84fedac><span class="icon" data-v-d84fedac><!--[--><span class="vpi-sun sun" data-v-537740e0></span><span class="vpi-moon moon" data-v-537740e0></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-70d97d16 data-v-ad52545c data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/Meteor-oxalis3" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-70d97d16 data-v-652282fd data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-feafea4e><span class="vpi-more-horizontal icon" data-v-feafea4e></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><!----><!--[--><!--[--><!----><div class="group" data-v-652282fd><div class="item appearance" data-v-652282fd><p class="label" data-v-652282fd>外观</p><div class="appearance-action" data-v-652282fd><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-652282fd data-v-537740e0 data-v-d84fedac><span class="check" data-v-d84fedac><span class="icon" data-v-d84fedac><!--[--><span class="vpi-sun sun" data-v-537740e0></span><span class="vpi-moon moon" data-v-537740e0></span><!--]--></span></span></button></div></div></div><div class="group" data-v-652282fd><div class="item social-links" data-v-652282fd><div class="vp-social-links social-links-list" data-v-652282fd data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/Meteor-oxalis3" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-70d97d16 data-v-2b50024d><span class="container" data-v-2b50024d><span class="top" data-v-2b50024d></span><span class="middle" data-v-2b50024d></span><span class="bottom" data-v-2b50024d></span></span></button></div></div></div></div><div class="divider" data-v-70d97d16><div class="divider-line" data-v-70d97d16></div></div></div><!----></header><div class="vp-local-nav reached-top is-blog" data-v-0b7e05b4 data-v-1dc3518c><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-1dc3518c><span class="vpi-align-left menu-icon" data-v-1dc3518c></span><span class="menu-text" data-v-1dc3518c>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-1dc3518c data-v-423a73ec><button data-v-423a73ec>返回顶部</button><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-0b7e05b4 data-v-360082b7><div class="curtain" data-v-360082b7></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-360082b7><span id="sidebar-aria-label" class="visually-hidden" data-v-360082b7> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 has-active" data-v-473fd05b data-v-b88148be><!----><div class="items" data-v-b88148be><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/NGS/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>README</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/NGS/2ycdno37/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>Course</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/NGS/2anb5jfk/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>Project 01</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-b88148be data-v-b88148be><div class="item" data-v-b88148be><div class="indicator" data-v-b88148be></div><!----><a class="vp-link no-icon link link" href="/NGS/fxwe3xh4/" data-v-b88148be data-v-442a52aa><!--[--><p class="text" data-v-b88148be>GATK4 安装方法</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-0b7e05b4 data-v-eb709286><div class="has-sidebar has-aside vp-doc-container" data-v-e798167f><!--[--><!--]--><div class="container" data-v-e798167f><div class="aside" vp-outline data-v-e798167f><div class="aside-curtain" data-v-e798167f></div><div class="aside-container" data-v-e798167f><div class="aside-content" data-v-e798167f><div class="vp-doc-aside" data-v-e798167f data-v-5976474c><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-5976474c data-v-aa56eba0><div class="content" data-v-aa56eba0><div class="outline-marker" data-v-aa56eba0></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-aa56eba0><span data-v-aa56eba0>此页内容</span><span class="vpi-print icon" data-v-aa56eba0></span></div><ul class="root" data-v-aa56eba0 data-v-54c74388><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-5976474c></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-e798167f><div class="content-container" data-v-e798167f><!--[--><!--]--><main class="main" data-v-e798167f><nav class="vp-breadcrumb" data-v-e798167f data-v-2901466a><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-2901466a><!--[--><li property="itemListElement" typeof="ListItem" data-v-2901466a><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-2901466a data-v-442a52aa><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-2901466a></span><meta property="position" content="1" data-v-2901466a></li><li property="itemListElement" typeof="ListItem" data-v-2901466a><a class="vp-link no-icon link breadcrumb current" href="/NGS/2anb5jfk/" property="item" typeof="WebPage" data-v-2901466a data-v-442a52aa><!--[-->Project 01<!--]--><!----></a><!----><meta property="position" content="2" data-v-2901466a></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-7007a277>Project 01 <!----></h1><div class="vp-doc-meta" data-v-7007a277><p class="reading-time" data-v-7007a277><span class="vpi-books icon" data-v-7007a277></span><span data-v-7007a277>4473字</span><span data-v-7007a277>约15分钟</span></p><!----><p class="create-time" data-v-7007a277><span class="vpi-clock icon" data-v-7007a277></span><span data-v-7007a277>2024-10-31</span></p></div><!--]--><div class="vp-doc plume-content _NGS_2anb5jfk_ external-link-icon-enabled" vp-content data-v-e798167f><p>2024 秋学期 高通量大作业 | 22230111 郎程闰 表观遗传组</p><hr><h1 id="基于snakemake-的-atac-seq-足迹识别与差异分析流程开发及应用-以-hcv-相关肝癌为例" tabindex="-1"><a class="header-anchor" href="#基于snakemake-的-atac-seq-足迹识别与差异分析流程开发及应用-以-hcv-相关肝癌为例"><span>基于<!---->Snakemake 的 ATAC-seq 足迹识别与差异分析流程开发及应用：以 HCV 相关肝癌为例</span></a></h1><h2 id="_1-前言" tabindex="-1"><a class="header-anchor" href="#_1-前言"><span>1. 前言</span></a></h2><h3 id="_1-1-背景" tabindex="-1"><a class="header-anchor" href="#_1-1-背景"><span>1.1 背景</span></a></h3><ul><li><p>慢性丙型肝炎病毒 ( HCV ) 感染是导致肝硬化和肝细胞癌 ( HCC ) 的主要致病因素。在全球范围内，约有 7100 万慢性 HCV 感染者，其中 10-20% 的患者在其一生中可能出现严重的肝脏并发症。表观遗传机制 ( 如 DNA 甲基化和组蛋白修饰 ) 在多种疾病过程中，尤其是肝病的发生和发展中，发挥了关键作用。HCV 感染能够显著改变这些表观遗传标记，并可能在感染治愈后留下 “表观遗传疤痕” ，从而导致长期的基因调控异常和癌症风险。</p></li><li><p>近年来，直接作用抗病毒药物 ( DAA ) 的发展为 HCV 的治愈提供了新的希望。然而，临床观察表明，即使在达到持续病毒学应答( SVR ) 后，患者的 HCC 风险仍未完全消除。这提示 HCV 感染可能通过持久的表观遗传损伤影响肝脏细胞功能，为理解这些过程的分子机制提供了研究必要性。</p></li></ul><h3 id="_1-2-目标" tabindex="-1"><a class="header-anchor" href="#_1-2-目标"><span>1.2 目标</span></a></h3><ul><li><p>​为了揭示 HCV 感染如何通过表观遗传途径影响肝细胞功能，以及在病毒清除后这些改变是否仍然持续，本研究构建了基于<!---->Snakemake 的 ATAC-seq 足迹分析与差异分析流程，对相关数据进行系统性分析。具体目标包括：</p><ol><li>构建高效、可重复的 Snakemake 流程，用于 ATAC-seq 数据的标准化处理、足迹识别和差异分析</li><li>比较 HCV 感染前后肝细胞系 ( Huh7.5 和 Hu1545 ) 染色质开放性和转录调控的变化</li><li>评估 HCV 治愈后，表观遗传标记的改变是否能够恢复正常</li><li>阐明 HCV 感染和治愈过程中关键基因失调的分子机制，为治疗策略优化提供数据支持</li></ol></li></ul><h2 id="_2-相关网址" tabindex="-1"><a class="header-anchor" href="#_2-相关网址"><span>2. 相关网址</span></a></h2><ul><li><p>代码仓库：<!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/" target="_blank" rel="noopener noreferrer">Meteor-oxalis3 / myATAC-seq</a></p><!----></li></ul><h2 id="_3-数据来源" tabindex="-1"><a class="header-anchor" href="#_3-数据来源"><span>3. 数据来源</span></a></h2><ul><li>GEO：<a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE168178" target="_blank" rel="noopener noreferrer">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE168178</a></li><li>对应文献：<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC9416882/" target="_blank" rel="noopener noreferrer">https://pmc.ncbi.nlm.nih.gov/articles/PMC9416882/</a></li></ul><blockquote><p>Hu1545 was derived from primary human hepatocytes from a de-identified donor without liver disease. Huh7.5 is a derivative of the Huh7 HCC cell line with a RIG-I mutation that leaves the cell line more susceptible to HCV infection</p></blockquote><p><img src="/assets/ATAC_seq_Data-GOdraREB.png" alt="ATAC_seq_Data"></p><h2 id="_4-环境工具" tabindex="-1"><a class="header-anchor" href="#_4-环境工具"><span>4. 环境工具</span></a></h2><ul><li>流程语言：<a href="https://snakemake.readthedocs.io/" target="_blank" rel="noopener noreferrer">Snakemake v8.25.5</a></li><li>软件包管理：<a href="https://mamba.readthedocs.io/en/latest/user_guide/micromamba.html" target="_blank" rel="noopener noreferrer">Micromamba v2.0.4</a></li><li>环境打包分发：<a href="https://docs.sylabs.io/guides/3.8/user-guide/" target="_blank" rel="noopener noreferrer">Singularity v3.8.6</a></li></ul><h2 id="_5-准备工作" tabindex="-1"><a class="header-anchor" href="#_5-准备工作"><span>5. 准备工作</span></a></h2><h3 id="_5-1-数据准备" tabindex="-1"><a class="header-anchor" href="#_5-1-数据准备"><span>5.1 数据准备</span></a></h3><ul><li><p>考虑到国内下载 SRA 的速度太慢，我在“赛博活菩萨”—— <!---->Cloudflare 那里搭建了一个镜像网站用于加速下载。还编写了一个 shell 小脚本 ( <code>cf-sra-get.sh</code> ) 进一步方便下载数据。</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查是否提供了参数</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -z</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ];</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> then</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Usage: $0 &lt;SRR_ID&gt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    exit</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 获取传入的SRR编号</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">SRR_ID</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">$1</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">SRA_NAME</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$SRR_ID.sra</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 下载文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">curl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -LS</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">https://sra.meteor-oxalis3.com/sra/$SRR_ID/$SRR_ID</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -o</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $SRA_NAME</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>开始下载数据：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cf-sra-get.sh</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./cf-sra-get.sh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> SRR13849295</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./cf-sra-get.sh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> SRR13849301</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./cf-sra-get.sh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> SRR13849307</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./cf-sra-get.sh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> SRR13849313</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>我定义的样本名称与对应的SRR号：</p><table><thead><tr><th style="text-align:center;">样本名称</th><th style="text-align:center;">SRR号</th><th style="text-align:left;">细胞类型</th></tr></thead><tbody><tr><td style="text-align:center;">Healthy1</td><td style="text-align:center;"><code>SRR13849295</code></td><td style="text-align:left;">Hu1545_ATAC</td></tr><tr><td style="text-align:center;">Healthy2</td><td style="text-align:center;"><code>SRR13849301</code></td><td style="text-align:left;">Hu1545_HCV_ATAC</td></tr><tr><td style="text-align:center;">HCC1</td><td style="text-align:center;"><code>SRR13849307</code></td><td style="text-align:left;">Huh7.5_ATAC</td></tr><tr><td style="text-align:center;">HCC2</td><td style="text-align:center;"><code>SRR13849313</code></td><td style="text-align:left;">Huh7.5_HCV_ATAC</td></tr></tbody></table></li><li><p>接下来我使用 <code>fasterq-dump</code> + <code>pigz</code> 的组合进行 <code>.sra</code> 转 <code>.fastq.gz</code>，比 <code>fastq-dump --gzip</code> 快不少 。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">fasterq-dump</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 30</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --split-files</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> SRR13849</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">*</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.sra</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pigz</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 30</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.fastq</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mv</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.fastq.gz</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/myATAC-seq/data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h3 id="_5-2-环境配置" tabindex="-1"><a class="header-anchor" href="#_5-2-环境配置"><span>5.2 环境配置</span></a></h3><ul><li><p>我采用了 <code>micromamba</code> 与 <code>singularity</code> 相结合的方案进行软件版本控制与分发：通过定义 <code>ATAC_seq_pipeline.def</code> 文件，在 <code>debian:bookworm-slim</code> 基础镜像中调用 <code>miccromamba</code> ，使用 <code>env_ATAC_seq.yml</code> 与 <code>env_idr.yml</code> 文件自动化构建 <code>myATAC-seq.sif</code> 镜像。</p></li><li><p>当然，也可以使用 <!----> <code>conda</code> 或者 <code>micromamba</code> 直接构建虚拟环境。</p></li><li><p>相关文件网址：<!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/tree/main/singularity" target="_blank" rel="noopener noreferrer">Meteor-oxalis3 / myATAC-seq · singularity</a></p></li><li><p>这里我在我的 <!----> <code>Fedora 41</code> 笔记本上构建好 <code>singularity</code> 镜像，再通过 <code>sftp</code> 传输到 <code>.9</code> 服务器进行后续的数据处理。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 首先克隆我的代码仓库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> clone</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git@github.com:Meteor-oxalis3/myATAC-seq.git</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 接着进入 singularity 的 .def 文件所在的文件夹</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> myATAC-seq/singularity</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 开始构建 .sif 镜像</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">singularity</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> build</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --fakeroot</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> myATAC-seq.sif</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ATAC_seq_pipeline.def</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>根据我之前折腾 <!----> <code>docker</code> 和 <code>singularity</code> 的经验，软链接相应文件后，挂载自己 <code>$HOME</code> 路径之外的数据可以直接挂载所在用户的家目录，无需在自己的 <code>$HOME</code> 路径新建同名文件夹。</p></li><li><p>借用一下邵老师已经下载好的相关数据，嘻嘻。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/myATAC-seq/data</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ln</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /public/workspace/shaojf/Course/NGS/Reference/BWA_Index/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ln</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /public/workspace/shaojf/Course/NGS/Reference/ENCODE/blacklist.v2/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ln</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /public/workspace/shaojf/Course/NGS/Reference/MEME/motif_databases/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ln</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /public/workspace/shaojf/Course/NGS/Reference/Ensembl/Homo_sapiens.GRCh38.100.chr.gtf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>流程运行时间较长，所以我在 <!----> <code>tmux</code> 里面运行 <code>singularity</code> 。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tmux</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> new</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">myATAC-seq</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/myATAC-seq/pre_and_peakcalling</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/myATAC-seq/pre_and_peakcalling</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">singularity</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> shell</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --bind</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /public/workspace/shaojf:/public/workspace/shaojf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../singularity/myATAC-seq.sif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="_6-数据预处理-peak-calling" tabindex="-1"><a class="header-anchor" href="#_6-数据预处理-peak-calling"><span>6. 数据预处理 + Peak Calling</span></a></h2><ul><li><p>参考这篇文献<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup>推荐的预处理步骤，我使用 <!----> <code>snakemake</code> 编写了一个流程，实现了从 ATAC-Seq 双末端测序的原始数据到 Peak Calling 的完整过程。</p><div style="text-align:center;"><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/pre.png" style="zoom:16%;"></div></li></ul><h3 id="_6-1-代码" tabindex="-1"><a class="header-anchor" href="#_6-1-代码"><span>6.1 代码</span></a></h3><ul><li>在 <code>singularity</code> 里面直接调用 <!----> <code>snakemake</code> 流程。 <ul><li><p>HCC1</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">snakemake</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../snakemake/pre_and_peakcalling/Snakefile</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--config </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">prefix=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HCC1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cores=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">bwa_index=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">genome_index=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa.fai</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">fastq1=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/SRR13849307_1.fastq.gz</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">fastq2=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/SRR13849307_2.fastq.gz</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">blacklist=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/blacklist.v2/hg38-blacklist.v2.bed</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>HCC2</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">snakemake</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../snakemake/pre_and_peakcalling/Snakefile</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--config </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">prefix=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HCC2</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cores=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">bwa_index=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">genome_index=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa.fai</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">fastq1=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/SRR13849313_1.fastq.gz</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">fastq2=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/SRR13849313_2.fastq.gz</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">blacklist=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/blacklist.v2/hg38-blacklist.v2.bed</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Healthy1</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">snakemake</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../snakemake/pre_and_peakcalling/Snakefile</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--config </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">prefix=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Healthy1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cores=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">bwa_index=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">genome_index=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa.fai</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">fastq1=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/SRR13849295_1.fastq.gz</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">fastq2=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/SRR13849295_2.fastq.gz</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">blacklist=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/blacklist.v2/hg38-blacklist.v2.bed</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Healthy2</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">snakemake</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../snakemake/pre_and_peakcalling/Snakefile</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--config </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">prefix=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Healthy2</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cores=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">bwa_index=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">genome_index=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa.fai</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">fastq1=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/SRR13849301_1.fastq.gz</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">fastq2=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/SRR13849301_2.fastq.gz</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">blacklist=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/blacklist.v2/hg38-blacklist.v2.bed</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul><h4 id="_6-1-1-数据链接" tabindex="-1"><a class="header-anchor" href="#_6-1-1-数据链接"><span>6.1.1 数据链接</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/pre_and_peakcalling/rules/link.smk" target="_blank" rel="noopener noreferrer">&quot;link.smk&quot;</a><p>将原始 <code>fastq.gz</code> 数据文件软链接到特定文件夹，方便后续调用。</p></li></ul><h4 id="_6-1-2-第一次质检" tabindex="-1"><a class="header-anchor" href="#_6-1-2-第一次质检"><span>6.1.2 第一次质检</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/pre_and_peakcalling/rules/fastqc_raw.smk" target="_blank" rel="noopener noreferrer">&quot;fastqc_raw.smk&quot;​</a><p>使用 <code>fastqc</code> 对原始下机数据进行第一次质量检查。</p></li></ul><h4 id="_6-1-3-接头剪切" tabindex="-1"><a class="header-anchor" href="#_6-1-3-接头剪切"><span>6.1.3 接头剪切</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/pre_and_peakcalling/rules/fastp.smk" target="_blank" rel="noopener noreferrer">&quot;fastp.smk&quot;</a><p>使用 <code>fastp</code> 的双末端模式自动识别接头类型并进行剪切。</p><ol><li><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/fastp/fastp_HCC1.html" target="_blank" rel="noopener noreferrer">📄 HCC1_fastp</a></li><li><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/fastp/fastp_HCC2.html" target="_blank" rel="noopener noreferrer">📄 HCC2_fastp</a></li><li><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/fastp/fastp_Healthy1.html" target="_blank" rel="noopener noreferrer">📄 Healthy1_fastp</a></li><li><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/fastp/fastp_Healthy2.html" target="_blank" rel="noopener noreferrer">📄 Healthy2_fastp</a></li></ol></li></ul><h4 id="_6-1-4-第二次质检" tabindex="-1"><a class="header-anchor" href="#_6-1-4-第二次质检"><span>6.1.4 第二次质检</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/pre_and_peakcalling/rules/fastqc_trimmed.smk" target="_blank" rel="noopener noreferrer">&quot;fastqc_trimmed.smk&quot;​</a><p>使用 <code>fastqc</code> 对剪切接头后的数据进行第二次质量检查。</p></li></ul><h4 id="_6-1-5-序列比对" tabindex="-1"><a class="header-anchor" href="#_6-1-5-序列比对"><span>6.1.5 序列比对</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/pre_and_peakcalling/rules/bwa.smk" target="_blank" rel="noopener noreferrer">&quot;bwa.smk&quot;</a><p>使用 <code>bwa</code> 进行序列比对到参考基因组，生成 <code>.sam</code> 文件。</p></li></ul><h4 id="_6-1-6-samtools-系列处理" tabindex="-1"><a class="header-anchor" href="#_6-1-6-samtools-系列处理"><span>6.1.6 samtools 系列处理</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/pre_and_peakcalling/rules/samtools.smk" target="_blank" rel="noopener noreferrer">&quot;samtools.smk&quot;</a><p>使用 <code>samtools</code> 对输入文件执行统计、格式转换、修复配对、排序、去重和索引等标准化处理步骤。</p></li></ul><h4 id="_6-1-7-偏移修正" tabindex="-1"><a class="header-anchor" href="#_6-1-7-偏移修正"><span>6.1.7 偏移修正</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/pre_and_peakcalling/rules/alignmentSieve.smk" target="_blank" rel="noopener noreferrer">&quot;alignmentSieve.smk&quot;</a><p>使用 <code>deeptools</code> 里面的 <code>alignmentSieve</code> 工具过滤和调整测序比对数据，并且使用 <code>samtools</code> 按照参考基因组的位置进行排序，方便后续的 <code>Diffbind</code> 差异分析。</p></li></ul><h4 id="_6-1-8-peak-calling" tabindex="-1"><a class="header-anchor" href="#_6-1-8-peak-calling"><span>6.1.8 Peak Calling</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/pre_and_peakcalling/rules/macs3.smk" target="_blank" rel="noopener noreferrer">&quot;macs3.smk&quot;</a><p>使用 <code>MACS3</code> 检测 peaks。</p></li></ul><h4 id="_6-1-9-汇总预处理结果" tabindex="-1"><a class="header-anchor" href="#_6-1-9-汇总预处理结果"><span>6.1.9 汇总预处理结果</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/pre_and_peakcalling/rules/multiqc.smk" target="_blank" rel="noopener noreferrer">&quot;multiqc.smk&quot;</a><p>使用 <code>multiqc</code> 将接头剪切和序列比对的结果进行汇总报告。</p><ol><li><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/multiqc/HCC1_multiqc_report.html" target="_blank" rel="noopener noreferrer">📄 HCC1_multiqc</a></li><li><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/multiqc/HCC2_multiqc_report.html" target="_blank" rel="noopener noreferrer">📄 HCC2_multiqc</a></li><li><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/multiqc/Healthy1_multiqc_report.html" target="_blank" rel="noopener noreferrer">📄 Healthy1_multiqc</a></li><li><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/multiqc/Healthy2_multiqc_report.html" target="_blank" rel="noopener noreferrer">📄 Healthy2_multiqc</a></li></ol></li></ul><h2 id="_7-足迹识别" tabindex="-1"><a class="header-anchor" href="#_7-足迹识别"><span>7. 足迹识别</span></a></h2><ul><li>这里我参考了 <code>TOBIAS</code> 官方<sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup>提供的流程图，自己编写了从上个流程的 4 个样本结果到 <code>BINDetect</code> 步骤的 <!----> <code>snakemake</code> 流程。 <div style="text-align:center;"><br><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/snakemake_workflow.png"><br><br><img src="/assets/footprinting-BTnFUuJW.png" style="zoom:16%;"></div></li></ul><h3 id="_7-1-代码" tabindex="-1"><a class="header-anchor" href="#_7-1-代码"><span>7.1 代码</span></a></h3><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/myATAC-seq/bindetect</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/myATAC-seq/bindetect</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">snakemake</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../snakemake/bindetect/Snakefile</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--config </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">case_prefix=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HCC</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> control_prefix=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Healthy</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cores=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">20</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">case1=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../pre_and_peakcalling/HCC1/</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">case2=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../pre_and_peakcalling/HCC2/</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">control1=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../pre_and_peakcalling/Healthy1/</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">control2=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../pre_and_peakcalling/Healthy2/</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">genome=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">genome_index=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/BWA_Index/Homo_sapiens.GRCh38.dna.primary_assembly.fa.fai</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">motifs=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../data/motif_databases/JASPAR/JASPAR2022_CORE_vertebrates_non-redundant_v2.meme</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-1-1-合并-bam" tabindex="-1"><a class="header-anchor" href="#_7-1-1-合并-bam"><span>7.1.1 合并 BAM</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/samtools_merge_case.smk" target="_blank" rel="noopener noreferrer">&quot;samtools_merge_case.smk&quot;</a>, <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/samtools_merge_control.smk" target="_blank" rel="noopener noreferrer">&quot;samtools_merge_control.smk&quot;</a><p>由于 <code>TOBIAS</code> 不支持生物学重复，所以需要将各组的 bam 文件合并一下。</p></li></ul><h4 id="_7-1-2-idr-分析" tabindex="-1"><a class="header-anchor" href="#_7-1-2-idr-分析"><span>7.1.2 IDR 分析</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/idr_case.smk" target="_blank" rel="noopener noreferrer">&quot;idr_case.smk&quot;</a>, <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/idr_control.smk" target="_blank" rel="noopener noreferrer">&quot;idr_control.smk&quot;</a><p>使用 <code>IDR</code> 进行 Peak 过滤和筛选，接着使用 <code>awk</code> 将通过 IDR 阈值的 Peak 提取后转换为 narrowPeak 格式。</p><ol><li><strong>HCC_idr.txt.png</strong></li></ol><div style="text-align:center;"><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/idr/HCC_idr.txt.png" style="zoom:50%;"></div><ol start="2"><li><strong>Healthy_idr.txt.png</strong></li></ol><div style="text-align:center;"><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/idr/Healthy_idr.txt.png" style="zoom:50%;"></div></li></ul><h4 id="_7-1-3-合并生成多样本共识-peaks" tabindex="-1"><a class="header-anchor" href="#_7-1-3-合并生成多样本共识-peaks"><span>7.1.3 合并生成多样本共识 Peaks</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/bedtools_merge.smk" target="_blank" rel="noopener noreferrer">&quot;bedtools_merge.smk&quot;</a><p>合并 <code>case</code> 组和 <code>control</code> 组的 IDR 结果，并通过 <code>bedtools</code> 对合并后的峰值进行排序和筛选，最后去除线粒体 DNA。</p></li></ul><h4 id="_7-1-4-atacorrect-矫正" tabindex="-1"><a class="header-anchor" href="#_7-1-4-atacorrect-矫正"><span>7.1.4 ATACorrect 矫正</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/tobias_ATACorrect_case.smk" target="_blank" rel="noopener noreferrer">&quot;tobias_ATACorrect_case.smk&quot;</a>, <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/tobias_ATACorrect_control.smk" target="_blank" rel="noopener noreferrer">&quot;tobias_ATACorrect_control.smk&quot;</a><p>使用 <code>TOBIAS</code> 对 <code>case</code> 组和 <code>control</code> 组的 BAM 文件和合并的 Peaks 进行 ATAC-seq 偏倚校正 Tn5 转座酶矫正。</p></li></ul><ol><li><!----> <a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/tobias/HCC_atacorrect.pdf" target="_blank" rel="noopener noreferrer"><strong>HCC_atacorrect.pdf</strong></a></li></ol><div class="pdf-viewer-wrapper" style="width:100%;height:auto;"></div><ol start="2"><li><!----> <a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/tobias/Healthy_atacorrect.pdf" target="_blank" rel="noopener noreferrer"><strong>Healthy_atacorrect.pdf</strong></a></li></ol><div class="pdf-viewer-wrapper" style="width:100%;height:auto;"></div><h4 id="_7-1-5-scorebigwig-足迹计算" tabindex="-1"><a class="header-anchor" href="#_7-1-5-scorebigwig-足迹计算"><span>7.1.5 ScoreBigwig 足迹计算</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/tobias_ScoreBigwig_case.smk" target="_blank" rel="noopener noreferrer">&quot;tobias_ScoreBigwig_case.smk&quot;</a>, <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/tobias_ScoreBigwig_control.smk" target="_blank" rel="noopener noreferrer">&quot;tobias_ScoreBigwig_control.smk&quot;</a><p>使用 <code>TOBIAS</code> 根据校正后的信号文件和合并的 Peaks 计算足迹。</p></li></ul><h4 id="_7-1-6-bindetect-分析" tabindex="-1"><a class="header-anchor" href="#_7-1-6-bindetect-分析"><span>7.1.6 BINDetect 分析</span></a></h4><ul><li><!----> <a href="https://github.com/Meteor-oxalis3/myATAC-seq/blob/main/snakemake/bindetect/rules/tobias_BINDetect.smk" target="_blank" rel="noopener noreferrer">&quot;tobias_BINDetect.smk&quot;</a><p>使用 <code>TOBIAS</code> 在 <code>case</code> 组和 <code>control</code> 组的足迹信号文件上进行 <code>BINDetect</code> 分析：首先在所有开发区域搜索已知的 motif 基序，确定可能的结合位点，再结合足迹分数，推测是否可能有 TF 结合。</p><ul><li>详细结果文件: <ol><li>表格：<!----><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/bindetect_results.xlsx" target="_blank" rel="noopener noreferrer"><code>~/myATAC-seq/bindetect/footprinting/bindetect_results.xlsx</code></a></li><li>交互式网页：<!----><a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/bindetect_HCC_Healthy.html" target="_blank" rel="noopener noreferrer"><code>~/myATAC-seq/bindetect/footprinting/bindetect_HCC_Healthy.html</code></a> <div style="text-align:center;"><br><iframe style="border:none;" width="100%" height="630px" src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/bindetect_HCC_Healthy.html"></iframe></div></li></ol></li></ul></li></ul><hr><h3 id="_7-2-单个-motif-分析" tabindex="-1"><a class="header-anchor" href="#_7-2-单个-motif-分析"><span>7.2 单个 motif 分析</span></a></h3><ul><li><p>这里我以 FOXA1 为例，进行单个 motif 分析，直观展示不同条件下的足迹可视化图谱。</p><h4 id="_7-2-1-聚合信号曲线图" tabindex="-1"><a class="header-anchor" href="#_7-2-1-聚合信号曲线图"><span>7.2.1 聚合信号曲线图</span></a></h4><ul><li><p>使用 <code>TOBIAS PlotAggregate</code> 绘制。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/myATAC-seq/bindetect/motif</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/myATAC-seq/bindetect/motif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">TOBIAS</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> PlotAggregate</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--TFBS </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_HCC_bound.bed </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_HCC_unbound.bed </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_Healthy_bound.bed </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_Healthy_unbound.bed </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--TFBS-labels </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HCC_bound</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> HCC_unbound</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Healthy_bound</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> HHealthy_unbound</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--signals </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../HCC/tobias/HCC_corrected.bw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../HCC/tobias/HCC_uncorrected.bw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../Healthy/tobias/Healthy_corrected.bw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../Healthy/tobias/Healthy_uncorrected.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--signal-labels </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HCC_corrected</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> HCC_uncorrected</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Healthy_corrected</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Healthy_uncorrected</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--output </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">FOXA1_MA0148.4_PlotAggregate.pdf</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--plot-boundaries</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!----> <strong>FOXA1_MA0148.4_PlotAggregate.pdf</strong> <div style="text-align:center;"><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/FOXA1_MA0148.4_PlotAggregate.png" style="zoom:10%;"></div></li></ul><h4 id="_7-2-2-热图" tabindex="-1"><a class="header-anchor" href="#_7-2-2-热图"><span>7.2.2 热图</span></a></h4><ul><li><p>使用 <code>TOBIAS PlotHeatmap</code> 绘制。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">TOBIAS</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> PlotHeatmap</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--TFBS </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_HCC_bound.bed </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_HCC_unbound.bed </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_Healthy_bound.bed </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_Healthy_unbound.bed </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--TFBS-labels </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HCC_bound</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> HCC_unbound</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Healthy_bound</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> HHealthy_unbound</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--signals </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../HCC/tobias/HCC_corrected.bw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../HCC/tobias/HCC_uncorrected.bw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../Healthy/tobias/Healthy_corrected.bw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ../Healthy/tobias/Healthy_uncorrected.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--signal-labels </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HCC_corrected</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> HCC_uncorrected</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Healthy_corrected</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Healthy_uncorrected</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--output </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">FOXA1_MA0148.4_PlotHeatmap.pdf</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--plot_boundaries</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!----><strong>FOXA1_MA0148.4_PlotHeatmap.pdf</strong> <div style="text-align:center;"><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/FOXA1_MA0148.4_PlotHeatmap.png" style="zoom:12%;"></div></li></ul><h3 id="_7-3-筛选位点" tabindex="-1"><a class="header-anchor" href="#_7-3-筛选位点"><span>7.3 筛选位点</span></a></h3><ul><li><p>我写了个 <!----> <code>shell</code> 脚本 <code>filter.sh</code> ，用于筛选前 20 个位点。</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 过滤条件 HCC_bound + Healthy_bound == 2</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">awk</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -F</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">\t</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">NR == 1 { next } $12 + $13 == 2 {print $0}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">../footprinting/FOXA1_MA0148.4/FOXA1_MA0148.4_overview.txt </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> filtered.tmp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 按 Healthy_score 降序排序, 并取前 20 行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sort</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">$&#39;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\t</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -k11,11nr</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> filtered.tmp</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> head</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -n</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 20</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> top20.tmp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 生成 plot_regions 数据</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">awk</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -F</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">\t</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    { </span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        plot_start = $8 - 1000;          # $8 是 peak_start</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        plot_end = $9 + 1000;            # $9 是 peak_end</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">        print $7, plot_start, plot_end;  # 输出 peak_chr, plot_start, plot_end</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    }</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> OFS=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">\t</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> top20.tmp</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">plot_regions.bed</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 清理中间文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">rm</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> filtered.tmp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> top20.tmp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>使用 <code>TOBIAS PlotTracks</code> 绘制 <code>IGV</code> 风格的全基因组信号轨迹，以观察足迹分布。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">TOBIAS</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> PlotTracks</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--bigwigs </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../../pre_and_peakcalling/HCC1/macs3/HCC1_treat_pileup.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--bigwigs </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../../pre_and_peakcalling/HCC2/macs3/HCC2_treat_pileup.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--bigwigs </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../../pre_and_peakcalling/Healthy1/macs3/Healthy1_treat_pileup.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--bigwigs </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../../pre_and_peakcalling/Healthy2/macs3/Healthy2_treat_pileup.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--bigwigs </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../../bindetect/HCC/tobias/HCC_corrected.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--bigwigs </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../../bindetect/Healthy/tobias/Healthy_corrected.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--bigwigs </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../../bindetect/HCC/tobias/HCC_footprints.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--bigwigs </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../../bindetect/Healthy/tobias/Healthy_footprints.bw</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--regions </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">plot_regions.bed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--sites </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_all.bed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--highlight </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../footprinting/FOXA1_MA0148.4/beds/FOXA1_MA0148.4_all.bed</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--gtf </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">../../data/Homo_sapiens.GRCh38.100.chr.gtf</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">--colors </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">red</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> darkblue</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> red</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> darkblue</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> red</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> darkblue</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>20 个位点汇总成一个 <!----> <a href="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/all_plots.pdf" target="_blank" rel="noopener noreferrer"><strong>all_plots.pdf</strong></a>。</p><div class="pdf-viewer-wrapper" style="width:100%;height:auto;"></div></li></ul></li></ul><h2 id="_8-差异分析" tabindex="-1"><a class="header-anchor" href="#_8-差异分析"><span>8. 差异分析</span></a></h2><h3 id="_8-1-准备工作" tabindex="-1"><a class="header-anchor" href="#_8-1-准备工作"><span>8.1 准备工作</span></a></h3><ul><li><p>构建样本元数据表 ( <code>~/myATAC-seq/data/sheet.csv</code> ):</p><table><thead><tr><th>SampleID</th><th>Tissue</th><th>Factor</th><th>Condition</th><th>Treatment</th><th>Replicate</th><th>bamReads</th><th>Peaks</th><th>PeakCaller</th></tr></thead><tbody><tr><td>Healthy1</td><td>NA</td><td>Healthy_Factor</td><td>Healthy_Condition</td><td>HCV-</td><td>1</td><td>/public/workspace/stu22230111/myATAC-seq/pre_and_peakcalling/Healthy1/alignmentSieve/ATACshifted_Healthy1_sorted.bam</td><td>/public/workspace/stu22230111/myATAC-seq/pre_and_peakcalling/Healthy1/macs3/Healthy1_peaks.narrowPeak</td><td>bed</td></tr><tr><td>Healthy2</td><td>NA</td><td>Healthy_Factor</td><td>Healthy_Condition</td><td>HCV+</td><td>2</td><td>/public/workspace/stu22230111/myATAC-seq/pre_and_peakcalling/Healthy2/alignmentSieve/ATACshifted_Healthy2_sorted.bam</td><td>/public/workspace/stu22230111/myATAC-seq/pre_and_peakcalling/Healthy2/macs3/Healthy2_peaks.narrowPeak</td><td>bed</td></tr><tr><td>HCC1</td><td>NA</td><td>HCC_Factor</td><td>HCC_Condition</td><td>HCV-</td><td>1</td><td>/public/workspace/stu22230111/myATAC-seq/pre_and_peakcalling/HCC1/alignmentSieve/ATACshifted_HCC1_sorted.bam</td><td>/public/workspace/stu22230111/myATAC-seq/pre_and_peakcalling/HCC1/macs3/HCC1_peaks.narrowPeak</td><td>bed</td></tr><tr><td>HCC2</td><td>NA</td><td>HCC_Factor</td><td>HCC_Condition</td><td>HCV+</td><td>2</td><td>/public/workspace/stu22230111/myATAC-seq/pre_and_peakcalling/HCC2/alignmentSieve/ATACshifted_HCC2_sorted.bam</td><td>/public/workspace/stu22230111/myATAC-seq/pre_and_peakcalling/HCC2/macs3/HCC2_peaks.narrowPeak</td><td>bed</td></tr></tbody></table></li></ul><h3 id="_8-2-代码" tabindex="-1"><a class="header-anchor" href="#_8-2-代码"><span>8.2 代码</span></a></h3><ul><li><p>直接使用 <!----> <code>Rscript</code> 运行：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Rscript</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/myATAC-seq/R_diffbind/diffbind.R</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><!----> R 代码详情如下 (点击下方箭头展开查看完整代码) ：<div class="language-r line-numbers-mode has-collapsed collapsed" data-ext="r" data-title="r" style="--vp-collapsed-lines:15;"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(DiffBind)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(tidyverse)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(corrplot)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(PCAtools)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 新建文件夹</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">output_dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">~/myATAC-seq/diffbind</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">dir.create</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(output_dir, </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">recursive</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TRUE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 切换工作目录</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">setwd</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(output_dir)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 加载样本信息</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">sampleSheet</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> read.csv</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">~/myATAC-seq/data/sheet.csv</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">sep</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\t</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sampleSheet</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 构建 DiffBind 对象</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> dba</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">sampleSheet</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> sampleSheet</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">config</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> data.frame</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">doBlacklist</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FALSE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> doGreylist</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FALSE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">bRemoveM</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FALSE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">bRemoveRandom</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FALSE</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 计算峰值</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> dba.count</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">summits</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 200</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 峰宽 = 2 * summits + 1</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">bUseSummarizeOverlaps</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TRUE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 更准，更慢</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">score</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DBA_SCORE_RPKM</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 标准化</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> dba.normalize</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">normalize</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DBA_NORM_TMM</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 提取 FPKM 数据</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">peaks_fpkm</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> diff_bind_obj</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">binding </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">%&gt;%</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">as_tibble</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> %&gt;%</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">mutate</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">peak_id</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> str_c</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">chr</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> CHR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> START</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">_</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> END</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> %&gt;%</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">column_to_rownames</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">var</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">peak_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> %&gt;%</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">select</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">CHR</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">START</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">END</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 绘制相关性热图并保存为 PDF</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">pdf</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> file.path</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(output_dir, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">correlation_plot.pdf</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">))</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">corrplot</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cor</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(peaks_fpkm</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">, </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">addCoef.col</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">white</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">dev.off</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># PCA 分析</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">pca</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> pca</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">peaks_fpkm</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> metadata</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> column_to_rownames</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sampleSheet</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> var</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SampleID</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 绘制 PCA 二维图并保存为 PDF</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">pdf</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> file.path</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(output_dir, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pca_biplot.pdf</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">))</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">biplot</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(pca, </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">colby</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Factor</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">dev.off</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 差异分析</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> dba.contrast</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">contrast</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Condition</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Healthy_Condition</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HCC_Condition</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">minMembers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> dba.analyze</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 差异分析结果展示</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># (这里的韦恩图好像没啥意义...)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># pdf(file = file.path(output_dir, &quot;differential_binding_venn.pdf&quot;))</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># dba.plotVenn(diff_bind_obj, contrast = 1, bDB = TRUE, bGain = TRUE, bLoss = TRUE, bAll = FALSE)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># dev.off()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 火山图</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">pdf</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> file.path</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(output_dir, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">differential_binding_volcano.pdf</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">))</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">dba.plotVolcano</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> contrast</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">dev.off</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 保存差异结果表</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">diff_bind_result</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> dba.report</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">diff_bind_table</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> as.data.frame</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(diff_bind_result)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">write.csv</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(diff_bind_table, </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> file.path</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(output_dir, </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">diff_bind_results.csv</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">), </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">row.names</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FALSE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 打印差异分析对比结果</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">print</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">dba.show</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">diff_bind_obj</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> bContrasts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TRUE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div></li></ul><h3 id="_8-3-结果" tabindex="-1"><a class="header-anchor" href="#_8-3-结果"><span>8.3 结果</span></a></h3><ul><li><p>三张图。</p><ol><li><!----> <strong>correlation_plot.pdf</strong></li></ol><div style="text-align:center;"><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/correlation_plot.png" style="zoom:25%;"></div><hr><ol start="2"><li><!----> <strong>pca_biplot.pdf</strong></li></ol><div style="text-align:center;"><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/pca_biplot.png" style="zoom:25%;"></div><hr><ol start="3"><li><!----> <strong>differential_binding_volcano.pdf</strong></li></ol><br><br><div style="text-align:center;"><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/differential_binding_volcano.png" style="zoom:30%;"></div></li></ul><hr><ul><li>最后来一张深度为 2 的 <code>tree</code> 作为收尾。</li></ul><div class="vp-file-tree"><ul><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">bindetect</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">footprinting</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">HCC</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">Healthy</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">motif</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">peak_merge</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li></ul><!--]--><!----></li><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">data</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">blacklist.v2</span><span class="comment">-&gt; /public/workspace/shaojf/Course/NGS/Reference/ENCODE/blacklist.v2/</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">BWA_Index</span><span class="comment">-&gt; /public/workspace/shaojf/Course/NGS/Reference/BWA_Index/</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">Homo_sapiens.GRCh38.100.chr.gtf</span><span class="comment">-&gt; /public/workspace/shaojf/Course/NGS/Reference/Ensembl/Homo_sapiens.GRCh38.100.chr.gtf</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">motif_databases</span><span class="comment">-&gt; /public/workspace/shaojf/Course/NGS/Reference/MEME/motif_databases/</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">sheet.csv</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">SRR13849295_1.fastq.gz</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">SRR13849295_2.fastq.gz</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">SRR13849301_1.fastq.gz</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">SRR13849301_2.fastq.gz</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">SRR13849307_1.fastq.gz</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">SRR13849307_2.fastq.gz</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">SRR13849313_1.fastq.gz</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">SRR13849313_2.fastq.gz</span></span><!--]--><!----></li></ul><!--]--><!----></li><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">diffbind</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">correlation_plot.pdf</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">diff_bind_results.csv</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">differential_binding_volcano.pdf</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">pca_biplot.pdf</span></span><!--]--><!----></li></ul><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">LICENSE</span></span><!--]--><!----></li><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">pre_and_peakcalling</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">HCC1</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">HCC2</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">Healthy1</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">Healthy2</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li></ul><!--]--><!----></li><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">R_diffbind</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">diffbind.R</span></span><!--]--><!----></li></ul><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">README.md</span></span><!--]--><!----></li><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">singularity</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">ATAC_seq_pipeline.def</span></span><!--]--><!----></li><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">bin</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">micromamba</span></span><!--]--><!----></li></ul><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">debian.sources</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">env_ATAC_seq.yml</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">env_idr.yml</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">myATAC-seq.sif</span></span><!--]--><!----></li></ul><!--]--><!----></li><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">snakemake</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">bindetect</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li><li class="file-tree-item"><!--[--><span class="tree-node folder"><!----><span class="name">pre_and_peakcalling</span></span><!--]--><ul><li class="file-tree-item"><span class="tree-node file"><span class="name">…</span></span></li></ul></li></ul><!--]--><!----></li></ul></div><h2 id="_9-总结" tabindex="-1"><a class="header-anchor" href="#_9-总结"><span>9. 总结</span></a></h2><h3 id="_9-1-实验结果" tabindex="-1"><a class="header-anchor" href="#_9-1-实验结果"><span>9.1 实验结果</span></a></h3><ul><li>在本次实验中, 我发现了FOX、HNF等转录因子家族对于 HCV 相关肝癌具有潜在调控作用 。</li><li>通过查阅相关文献资料<sup class="footnote-ref"><a href="#footnote3">[3]</a><a class="footnote-anchor" id="footnote-ref3"></a></sup>, 也进一步佐证了我的发现: FOXA 家族成员最初存在于肝细胞核提取物中，研究表明肝脏发育的开始取决于 FOXA 家族成员<sup class="footnote-ref"><a href="#footnote4">[4]</a><a class="footnote-anchor" id="footnote-ref4"></a></sup> <sup class="footnote-ref"><a href="#footnote5">[5]</a><a class="footnote-anchor" id="footnote-ref5"></a></sup>。FOXA1 和 FOXA2 激活前肠内胚层内的发育基因，以建立对器官特异性信号的反应能力并诱导肝脏特异性基因的表达 <sup class="footnote-ref"><a href="#footnote5">[5:1]</a><a class="footnote-anchor" id="footnote-ref5:1"></a></sup>。</li><li>因此，当 FOXA1 和 FOXA2 缺失时，肝脏基因调控网络被破坏，导致肝脏关键基因的表达迅速而大幅降低，从而严重影响肝脏发育和功能 <sup class="footnote-ref"><a href="#footnote4">[4:1]</a><a class="footnote-anchor" id="footnote-ref4:1"></a></sup>。</li><li>来自 HNF 转录因子家族 的 HNF4α 在维持肝脏稳态中也起着至关重要的作用。然而, HNF4α 的突变或其靶向基因启动子区域的表观遗传修饰会导致其功能特性的丧失。值得注意的是, HNF4α 表达升高与肝细胞癌 HCC 患者的良好预后相关。<sup class="footnote-ref"><a href="#footnote6">[6]</a><a class="footnote-anchor" id="footnote-ref6"></a></sup></li></ul><h3 id="_9-2-小技巧" tabindex="-1"><a class="header-anchor" href="#_9-2-小技巧"><span>9.2 小技巧</span></a></h3><h4 id="_9-2-1-快速查看服务器上的文件" tabindex="-1"><a class="header-anchor" href="#_9-2-1-快速查看服务器上的文件"><span>9.2.1 快速查看服务器上的文件</span></a></h4><ul><li><p>想要查看结果文件 ( PDF、HTML、PNG等 ), 可以先 <code>cd</code> 到相应路径，然后使用 <!----> <code>python3</code> 中的 <code>http.server</code> 模块将文件夹临时暴露成类似于 <!----> <code>nginx</code> 那样的静态文件服务（ 11111 是端口号，可以随便设置，建议范围在 10000 - 60000 之间 ):</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">python3</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> http.server</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 11111</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>在本地电脑上的浏览器输入服务器对应的 <code>ip地址:端口</code> ，即可访问：</p><div style="text-align:center;"><img src="https://r2-hugo.meteor-oxalis3.com/02_NGS/Project_01/python_httpserver1.png" style="zoom:80%;"></div></li></ul><h4 id="_9-2-2-命令行下-pdf-转-png" tabindex="-1"><a class="header-anchor" href="#_9-2-2-命令行下-pdf-转-png"><span>9.2.2 命令行下 <code>pdf</code> 转 <code>png</code></span></a></h4><ul><li><p>使用 <!----> <code>imagemagick</code> 软件可以通过命令行快速进行常见图片格式的转换操作。需要使用 <!----> <code>conda</code> 或 <code>micromamba</code> 安装 <!----> <code>imagemagick</code> 软件后使用。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 假如你用的是 anaconda/miniconda</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">conda</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> conda-forge</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> imagemagick</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 假如你用的是 micromamba</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">micromamba</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> conda-forge</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> imagemagick</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># pdf转png (density是分辨率，ppi)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">magick</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -density</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 300</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> foo.pdf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> foo.png</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_9-3-注意" tabindex="-1"><a class="header-anchor" href="#_9-3-注意"><span>9.3 注意</span></a></h3><ol><li><code>peak_merge</code> 的结果需要手动去除线粒体 DNA ，我使用的是 <code>grep -Ev &#39;(chrM|chrMT|M|MT|Mito)&#39;</code> 。</li><li><code>DiffBind</code> 输入只能为 <code>bam</code> 或 <code>bed</code> 或 <code>bed.gz</code>，<code>alignmentSieve</code> 那步输出不可为 <code>bedpe</code>，而且还需要再次 <code>samtools</code> 排序。</li><li>通过 <code>conda-forge</code> 源安装的 <code>singularity</code> 在某些系统上可能会出现 <code>Failed to create user namespace: user namespace disabled: exit status 1</code> ，可以联系服务器管理员临时调整最大用户命名空间：<code>sudo sysctl user.max_user_namespaces=65536</code>，或永久调整：<code>echo &quot;user.max_user_namespaces=65536&quot; &gt;&gt; /etc/sysctl.conf</code></li><li>使用 <code>Diffbind</code> 中的 <code>dba.count</code> 函数时，所需的 <code>.bam</code> 文件需要按照参考基因组的位置进行排序，我在 <code>pre_and_peakcalling</code> 的 “偏移修正” 步骤里面已经使用 <code>samtools</code> 排序了。</li></ol><h2 id="_10-参考文献" tabindex="-1"><a class="header-anchor" href="#_10-参考文献"><span>10. 参考文献</span></a></h2><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p>Grandi, F.C., Modi, H., Kampman, L. <em>et al.</em> Chromatin accessibility profiling by ATAC-seq. <em>Nat Protoc</em> <strong>17</strong>, 1518–1552 (2022). https://doi.org/10.1038/s41596-022-00692-9 <a href="#footnote-ref1" class="footnote-backref">↩︎</a></p></li><li id="footnote2" class="footnote-item"><p>Bentsen, M., Goymann, P., Schultheis, H. <em>et al.</em> ATAC-seq footprinting unravels kinetics of transcription factor binding during zygotic genome activation. <em>Nat Commun</em> <strong>11</strong>, 4267 (2020). https://doi.org/10.1038/s41467-020-18035-1 <a href="#footnote-ref2" class="footnote-backref">↩︎</a></p></li><li id="footnote3" class="footnote-item"><p>Liu, N., Wang, A., Xue, M. et al. FOXA1 and FOXA2: the regulatory mechanisms and therapeutic implications in cancer. Cell Death Discov. 10, 172 (2024). https://doi.org/10.1038/s41420-024-01936-1 <a href="#footnote-ref3" class="footnote-backref">↩︎</a></p></li><li id="footnote4" class="footnote-item"><p>Reizel, Y., Morgan, A., Gao, L., Lan, Y., Manduchi, E., Waite, E. L., Wang, A. W., Wells, A., &amp; Kaestner, K. H. (2020). Collapse of the hepatic gene regulatory network in the absence of FoxA factors. Genes &amp; development, 34(15-16), 1039–1050. https://doi.org/10.1101/gad.337691.120 <a href="#footnote-ref4" class="footnote-backref">↩︎</a> <a href="#footnote-ref4:1" class="footnote-backref">↩︎</a></p></li><li id="footnote5" class="footnote-item"><p>Lee, C., Friedman, J., Fulmer, J. et al. The initiation of liver development is dependent on Foxa transcription factors. Nature 435, 944–947 (2005). https://doi.org/10.1038/nature03649 <a href="#footnote-ref5" class="footnote-backref">↩︎</a> <a href="#footnote-ref5:1" class="footnote-backref">↩︎</a></p></li><li id="footnote6" class="footnote-item"><p>Qu, N., Luan, T., Liu, N., Kong, C., Xu, L., Yu, H., Kang, Y., &amp; Han, Y. (2023). Hepatocyte nuclear factor 4 a (HNF4α): A perspective in cancer. Biomedicine &amp; pharmacotherapy = Biomedecine &amp; pharmacotherapie, 169, 115923. https://doi.org/10.1016/j.biopha.2023.115923 <a href="#footnote-ref6" class="footnote-backref">↩︎</a></p></li></ol></section></div></main><footer class="vp-doc-footer" data-v-e798167f data-v-f2100d82><!--[--><!--]--><!----><!----><nav class="prev-next" data-v-f2100d82><div class="pager" data-v-f2100d82><a class="vp-link no-icon link pager-link prev" href="/NGS/2ycdno37/" data-v-f2100d82 data-v-442a52aa><!--[--><span class="desc" data-v-f2100d82>上一页</span><span class="title" data-v-f2100d82>Course</span><!--]--><!----></a></div><div class="pager" data-v-f2100d82><a class="vp-link no-icon link pager-link next" href="/NGS/fxwe3xh4/" data-v-f2100d82 data-v-442a52aa><!--[--><span class="desc" data-v-f2100d82>下一页</span><span class="title" data-v-f2100d82>GATK4 安装方法</span><!--]--><!----></a></div></nav></footer><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;" data-v-e798167f><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-0b7e05b4 data-v-c122fdb6><span class="percent" data-allow-mismatch data-v-c122fdb6>0%</span><span class="show icon vpi-back-to-top" data-v-c122fdb6></span><svg aria-hidden="true" data-v-c122fdb6><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-c122fdb6></circle></svg></button><footer class="vp-footer has-sidebar" vp-footer data-v-0b7e05b4 data-v-368f94aa><div class="container" data-v-368f94aa><p class="message" data-v-368f94aa>Powered by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><!----></div></footer><!--[--><!--]--><!--]--></div><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-BTx-WnE2.js" defer></script></body></html>