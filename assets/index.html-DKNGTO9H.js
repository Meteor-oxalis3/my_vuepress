import{_ as t,c as d,a as n,b as i,d as a,e as l,w as r,r as p,o as k}from"./app-CdJGwZO9.js";const c={};function o(g,s){const e=p("VPIcon"),h=p("Plot");return k(),d("div",null,[s[28]||(s[28]=n(`<h2 id="_0-前言" tabindex="-1"><a class="header-anchor" href="#_0-前言"><span>0. 前言</span></a></h2><ul><li>在刚开始学习使用 Linux 的时候，大家几乎都是使用 <code>OpenSSH</code> 的 <code>ssh</code> 命令登录到服务器的吧~</li><li>在我使用 Linux 学习、开发，以及日常逛知乎的过程中，有缘接触到了 SSH &quot;端口三剑客&quot; 的使用，在此分享给大家。</li></ul><h2 id="_1-远程端口转发到本地-参数-l" tabindex="-1"><a class="header-anchor" href="#_1-远程端口转发到本地-参数-l"><span>1. 远程端口转发到本地（参数 <code>-L</code>）</span></a></h2><ul><li><p>有的时候在服务器上开启了一个端口服务（例如：Jupyter Lab），可是只能通过服务器上的 <code>127.0.0.1</code> 或 <code>localhost</code>，才能访问。</p><div class="language-txt line-numbers-mode" data-highlighter="shiki" data-ext="txt" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-txt"><span class="line"><span>$ jupyter lab</span></span>
<span class="line"><span>To access the server, open this file in a browser:</span></span>
<span class="line"><span>	file:/home/asparagus/.local/share/jupyter/runtime/jpserver-15584-open.html</span></span>
<span class="line"><span>Or copy and paste one of these URLs:</span></span>
<span class="line"><span>	http://localhost:8888/lab?token=97615e2aa2e9841decfe56e87419a11202c2ccb5a2e8f340</span></span>
<span class="line"><span>    http://127.0.0.1:8888/lab?token=97615e2aa2e9841decfe56e87419a11202c2ccb5a2e8f340</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>总不能为这碟醋而包个饺子，在远程服务器上装个桌面环境（ Gnome、KDE 等）或者窗口管理器（ i3wm、sway、niri 等），以及笨重的浏览器、VNC服务吧！毕竟可能没有 <code>root</code> 权限或者服务器资源有限。</p></li><li><p>此外，从安全的角度考虑，如果这些服务的端口直接暴露到公网上（0.0.0.0），确实是方便我们访问了，但有潜在的风险——总有些吃饱了撑的人会挂个脚本，日夜午休爆破你的端口。</p></li><li><p>聪明的做法则是把对应端口通过 <code>ssh</code> 安全的转发到本地主机的 <code>127.0.0.1</code> 或 <code>localhost</code> 上，通过本地主机的浏览器来访问：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 推荐额外添加 -N 与 -T 参数，这样就不会进入ssh的交互界面了</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 注意：需要保持当前终端一直开启，不要关闭</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 在本地电脑上:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ssh</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -NTL</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 127.0.0.1:8888:127.0.0.1:8888</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 远程服务器上的账户名@远程服务器的IP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 语法：-L [本地监听地址:]本地端口:远端地址:远端端口</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 第一个127.0.0.1和8888是你本地电脑的回环ip与端口，如果端口冲突可以换成别的</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 第二个127.0.0.1和8888是你远程服务器的回环ip与端口，根据你想转发的具体服务来调整（这里即我远程运行的 Jupyterlab 服务）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>之后在你的本地电脑上打开浏览器，输入之前对应的网址（例如我的：<code>http://localhost:8888/lab?token=97615e2aa2e9841decfe56e87419a11202c2ccb5a2e8f340</code>），就可以安全访问啦。</p><p><img src="https://r2-hugo.dudleya.cc/03_Linux/ssh_forwarding_jupyterlab.png" alt="ssh_forwarding_jupyterlab"></p></li></ul><h2 id="_2-本地端口转发到远程-参数-r" tabindex="-1"><a class="header-anchor" href="#_2-本地端口转发到远程-参数-r"><span>2. 本地端口转发到远程（参数 <code>-R</code>）</span></a></h2>`,5)),i("ul",null,[s[14]||(s[14]=i("li",null,[i("p",null,"既然能把端口从远程服务器转发到本地主机，那反过来是不是也可以呢？（同样也是为了安全考虑）")],-1)),s[15]||(s[15]=i("li",null,[i("p",null,[a("记得我当初开发网站的时候，由于囊中羞涩，使用的云服务器都是很小的配置，根本跑不了完整的生信流程，更不用说在此基础上开发类似于 "),i("code",null,"Galaxy"),a(" 那样的在线分析平台了。")])],-1)),s[16]||(s[16]=i("li",null,[i("p",null,[a("毕竟给我的网站上域名怎么也得有个公网 IP 吧（ "),i("code",null,"Cloudflare Tunnel"),a(" 除外）。")])],-1)),s[17]||(s[17]=i("li",null,[i("p",null,"于是我脑中灵机一动，可不可以在本地服务器运行具体的生信分析流程，远程服务器只作为公网上的“传话筒”，将用户通过域名访问的相关操作，传递到性能较好但没有公网 IP 的本地服务器上呢？")],-1)),i("li",null,[i("p",null,[s[0]||(s[0]=a("答案当然是肯定的，之前准备计算机设计比赛时我就用到了 ",-1)),s[1]||(s[1]=i("code",null,"-R",-1)),s[2]||(s[2]=a(" 这个参数，将本地服务器上的 ",-1)),l(e,{provider:"iconify",name:"devicon:flask"}),s[3]||(s[3]=a()),s[4]||(s[4]=i("code",null,"Flask",-1)),s[5]||(s[5]=a(" 后端服务转发到远程服务器进行访问。",-1))]),s[6]||(s[6]=n(`<div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 推荐额外添加 -N 与 -T 参数，这样就不会进入ssh的交互界面了</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 同样的，也要保持当前终端一直开启，不要关闭</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 在本地电脑上:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ssh</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -NTR</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 127.0.0.1:8000:127.0.0.1:8000</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 远程服务器上的账户名@远程服务器的IP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 语法：-R [远程监听地址:]远程端口:本地地址:本地端口</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 第一个127.0.0.1和8000是你远程服务器的回环ip与端口，如果端口冲突可以换成别的</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 第二个127.0.0.1和8000是你本地服务器的回环ip与端口，根据你想转发的具体服务来调整（这里即我本地运行的 Flask 后端服务）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1))]),i("li",null,[i("p",null,[s[7]||(s[7]=a("然后在远程服务器上就可以访问本地的 ",-1)),l(e,{provider:"iconify",name:"devicon:flask"}),s[8]||(s[8]=a()),s[9]||(s[9]=i("code",null,"Flask",-1)),s[10]||(s[10]=a(" 了，最终使用 ",-1)),l(e,{provider:"iconify",name:"material-icon-theme:nginx"}),s[11]||(s[11]=a()),s[12]||(s[12]=i("code",null,"NGINX",-1)),s[13]||(s[13]=a(" 给它上了域名，实现安全的公网访问。",-1))])])]),s[29]||(s[29]=i("h2",{id:"_3-动态转发端口-参数-d",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#_3-动态转发端口-参数-d"},[i("span",null,[a('3. "动态转发端口"（参数 '),i("code",null,"-D"),a("）")])])],-1)),i("ul",null,[s[24]||(s[24]=i("li",null,[i("p",null,[a("有时候克隆 "),i("code",null,"Github"),a(" 仓库真的慢，即便使用第三方镜像，加速效果也不一定稳定。")])],-1)),s[25]||(s[25]=i("li",null,[i("p",null,[a("还有下载一些服务器位于国外的文件，例如 "),i("code",null,"NCBI SRA"),a(" 的文件大多在亚马逊云上，国内下载速度也很感人。")])],-1)),s[26]||(s[26]=i("li",null,[i("p",null,[a("别急，"),i("code",null,"ssh"),a(' "端口三剑客" 的最后一位可以来帮忙！')])],-1)),i("li",null,[i("p",null,[s[19]||(s[19]=i("code",null,"-D",-1)),s[20]||(s[20]=a(" 参数可以在本地主机开一个 ",-1)),s[21]||(s[21]=i("code",null,"socks4/5",-1)),s[22]||(s[22]=a(" 端口（",-1)),l(h,null,{default:r(()=>[...s[18]||(s[18]=[a("这不相当于是个梯子嘛",-1)])]),_:1}),s[23]||(s[23]=a("），可以相对提高我们本地主机对国外网站的访问速度。",-1))])]),s[27]||(s[27]=n(`<li><p>前提是需要租一台国外的服务器，装有 <code>openssh</code> 并且启用了 <code>sshd</code> 服务。</p></li><li><p>具体操作如下：</p><h3 id="_3-1-配置代理端口" tabindex="-1"><a class="header-anchor" href="#_3-1-配置代理端口"><span>3.1 配置代理端口</span></a></h3><ul><li><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 推荐额外添加 -N 与 -T 参数，这样就不会进入ssh的交互界面了</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 同样的，也要保持当前终端一直开启，不要关闭</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 在本地主机上:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ssh</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -NTD</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1080</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 远程服务器上的账户名@远程服务器的IP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_3-2-安装-proxychains" tabindex="-1"><a class="header-anchor" href="#_3-2-安装-proxychains"><span>3.2 安装 <code>proxychains</code></span></a></h3><ul><li><p>接下来，该如何使用上面的 <code>socks5</code> 代理呢？</p></li><li><p>虽然像 <code>curl</code>、<code>git</code> 等工具本身就支持 <code>socks5</code> 代理，但还是有些软件不支持（ 如wget ），或者配置起来比较麻烦，所以我这里通过 <code>proxychains</code> 软件统一一下，使用时只需要在相关命令最前面添加 <code>proxychains</code> 及对应参数即可。</p></li><li><p>根据你的情况，选择下列其中一种方法：</p><h4 id="_3-2-1-使用-conda-mamba-安装" tabindex="-1"><a class="header-anchor" href="#_3-2-1-使用-conda-mamba-安装"><span>3.2.1 使用 <code>conda</code> / <code>mamba</code> 安装</span></a></h4><ul><li><p>假如你已经装了 <code>anaconda</code> / <code>miniconda</code> / <code>miniforge</code> / <code>mamba</code> / <code>micromamba</code>，可以直接去 <code>conda-forge</code> 频道安装。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 安装步骤根据你的情况，三选一即可</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## anaconda / miniconda</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">conda</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> conda-forge</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxychains-ng</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## miniforge / mamba</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mamba</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> conda-forge</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxychains-ng</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## micromamba</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">micromamba</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> conda-forge</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxychains-ng</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 编辑配置文件</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">[ProxyList]\\nsocks5 127.0.0.1 1080</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.local/proxychains.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 测试（-q 参数简化相关输出）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">proxychains4</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -q</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.local/proxychains.conf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> curl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://api.ip.sb/geoip</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查输出，是否是你远程服务器的地区和ip</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 如果是，则说明成功啦</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 如果还是国内ip，则需要仔细排错一下咯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_3-2-2-编译安装" tabindex="-1"><a class="header-anchor" href="#_3-2-2-编译安装"><span>3.2.2 编译安装</span></a></h4><ul><li>假如你没有安装上述虚拟环境包管理器，可以通过编译安装（需要 gcc、make等工具链）。<div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 这里使用 kkgithub 镜像加速下载源代码</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://kkgithub.com/rofl0r/proxychains-ng/releases/download/v4.17/proxychains-ng-4.17.tar.xz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 解压后进入文件夹</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tar</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> xvf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxychains-ng-4.17.tar.xz</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxychains-ng-4.17</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 最终将 proxychains 安装到 $HOME/.local/bin 路径</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">./configure</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --prefix=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$HOME</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">/.local</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 编译并安装</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">make</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> &amp;&amp;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> make</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 编辑配置文件</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">[ProxyList]\\nsocks5 127.0.0.1 1080</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.local/proxychains.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 测试（-q 参数简化相关输出）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">proxychains4</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -q</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.local/proxychains.conf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> curl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://api.ip.sb/geoip</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查输出，是否是你远程服务器的地区和ip</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 如果是，则说明成功啦</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 如果还是国内ip，则需要仔细排错一下咯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_3-2-3-系统级包管理器安装" tabindex="-1"><a class="header-anchor" href="#_3-2-3-系统级包管理器安装"><span>3.2.3 系统级包管理器安装</span></a></h4><ul><li><p>假如你有 <code>root</code> 权限，想装完让大家一起用的话：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 根据你的本地服务器发行版自行选择对应包管理器</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## Debian系</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxychains4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## Red Hat系</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yum</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxychains-ng</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # CentOS</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dnf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxychains-ng</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # rhel、fedora等</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## 其他的发行版请自行上网搜索，注意包名可能略有不同</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 编辑配置文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vim</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/proxychains.conf</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 将最后一行修改成 socks5 127.0.0.1 1080</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 测试（-q 参数简化相关输出）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">proxychains4</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -q</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> curl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://api.ip.sb/geoip</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查输出，是否是你远程服务器的地区和ip</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 如果是，则说明成功啦</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 如果还是国内ip，则需要仔细排错一下咯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul><h3 id="_3-3-使用-socks5-代理" tabindex="-1"><a class="header-anchor" href="#_3-3-使用-socks5-代理"><span>3.3 使用 <code>socks5</code> 代理</span></a></h3><ul><li><p>使用时只需要在相关命令最前面添加 <code>proxychains</code> 及对应参数即可。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># -q 参数简化相关输出, -f 指定 proxychains 的配置文件</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## git clone</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">proxychains4</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -q</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.local/proxychains.conf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> clone</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/vim/vim</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">## wget</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">proxychains4</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -q</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.local/proxychains.conf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> wget</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/vim/vim/archive/refs/heads/master.zip</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>当然，为了方便使用，可以添加一个 <code>alias</code> 到你的 shell 里面。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 以 bash 为例</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">alias pc=&#39;proxychains4 -q -f ~/.local/proxychains.conf&#39;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.bashrc</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">source</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/.bashrc</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 这样以后使用起来就方便啦~</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> clone</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/vim/vim</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> wget</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/vim/vim/archive/refs/heads/master.zip</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li>`,2))]),s[30]||(s[30]=n('<h2 id="_4-尾声" tabindex="-1"><a class="header-anchor" href="#_4-尾声"><span>4. 尾声</span></a></h2><ul><li><p>当然，上述的 &quot;三剑客&quot; 其实局限性也很大，例如只能转发 TCP 端口、对 UDP 端口无效，需要前台一直挂着，不好配置常驻服务等。因此只适合临时使用。</p></li><li><p>日常开发中，我还是喜欢直接用 <code>VSCode</code> Remote SSH 插件中的 <a href="https://code.visualstudio.com/docs/remote/ssh#_forwarding-a-port-creating-ssh-tunnel" target="_blank" rel="noopener noreferrer">Port Forwarding</a>，免去了很多麻烦（端口冲突等）。</p></li><li><p>实际的生产环境中，<code>openssh</code> 的 <code>-L</code> 与 <code>-R</code> 参数可以被端口转发工具（如 <a href="https://gofrp.org/zh-cn/docs/" target="_blank" rel="noopener noreferrer"><code>frp</code></a> 等）或虚拟组网工具（如 <a href="https://www.wireguard.com/" target="_blank" rel="noopener noreferrer"><code>wireguard</code></a> 等）替代，以实现更加稳定的端口转发服务。而 <code>-D</code> 参数的替代品就不再展开讲了，毕竟懂得都懂，嘻嘻。</p></li><li><p>同样的，<code>sshd</code> 服务本身的端口也需要注意防护攻击：比如禁用 <code>root</code> 登录、仅允许使用密钥登录、部署 <code>fail2ban</code> 服务等，从而加强公网服务器自身的安全等级。</p></li><li><p>附录：<a href="https://man.openbsd.org/ssh" target="_blank" rel="noopener noreferrer">OpenSSH 官方手册</a></p></li></ul>',2))])}const u=t(c,[["render",o]]),v=JSON.parse(`{"path":"/article/v444aags/","title":"SSH \\"端口三剑客\\"（-L、-R、-D参数的妙用）","lang":"zh-CN","frontmatter":{"title":"SSH \\"端口三剑客\\"（-L、-R、-D参数的妙用）","createTime":"2026/01/01 16:09:34","permalink":"/article/v444aags/","tags":["Linux","openssh","ssh","proxy"],"description":"0. 前言 在刚开始学习使用 Linux 的时候，大家几乎都是使用 OpenSSH 的 ssh 命令登录到服务器的吧~ 在我使用 Linux 学习、开发，以及日常逛知乎的过程中，有缘接触到了 SSH \\"端口三剑客\\" 的使用，在此分享给大家。 1. 远程端口转发到本地（参数 -L） 有的时候在服务器上开启了一个端口服务（例如：Jupyter Lab），可...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SSH \\\\\\"端口三剑客\\\\\\"（-L、-R、-D参数的妙用）\\",\\"image\\":[\\"https://r2-hugo.dudleya.cc/03_Linux/ssh_forwarding_jupyterlab.png\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://meteor-oxalis3.com/article/v444aags/"}],["meta",{"property":"og:site_name","content":"Meteor03's Oxalis Garden"}],["meta",{"property":"og:title","content":"SSH \\"端口三剑客\\"（-L、-R、-D参数的妙用）"}],["meta",{"property":"og:description","content":"0. 前言 在刚开始学习使用 Linux 的时候，大家几乎都是使用 OpenSSH 的 ssh 命令登录到服务器的吧~ 在我使用 Linux 学习、开发，以及日常逛知乎的过程中，有缘接触到了 SSH \\"端口三剑客\\" 的使用，在此分享给大家。 1. 远程端口转发到本地（参数 -L） 有的时候在服务器上开启了一个端口服务（例如：Jupyter Lab），可..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://r2-hugo.dudleya.cc/03_Linux/ssh_forwarding_jupyterlab.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"proxy"}],["meta",{"property":"article:tag","content":"ssh"}],["meta",{"property":"article:tag","content":"openssh"}],["meta",{"property":"article:tag","content":"Linux"}]]},"readingTime":{"minutes":7.82,"words":2346},"git":{},"autoDesc":true,"filePathRelative":"Linux/ssh_forwarding.md","headers":[],"categoryList":[{"id":"edc9f0","sort":10002,"name":"Linux"}]}`);export{u as comp,v as data};
